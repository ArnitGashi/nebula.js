import picassojs from 'picasso.js';
import picassoQ from 'picasso-plugin-q';

import picSelections from './pic-selections';

import definition from './picasso-definition';

export default function pic({
  element,
  selections,
}) {
  const picasso = picassojs();
  picasso.use(picassoQ);

  const instance = picasso.chart({
    element,
    data: [],
    settings: {},
  });

  const picsel = picSelections({
    selections,
    brush: instance.brush('selection'),
    picassoQ,
  });

  return {
    update({ layout, context }) {
      instance.update({
        data: [{
          type: 'q',
          key: 'qHyperCube',
          data: layout.qHyperCube,
        }],
        settings: definition({ layout, context }),
      });
    },
    destroy() {
      picsel.release();
      instance.destroy();
    },
  };
}
